name: Import batch-1 from hz-oneclick

on:
  workflow_dispatch:

permissions:
  contents: write
  pull-requests: write

jobs:
  import:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout horizon-lab
        uses: actions/checkout@v4

      - name: Checkout hz-oneclick
        uses: actions/checkout@v4
        with:
          repository: Hello-Pork-Belly/hz-oneclick
          path: /tmp/hz-oneclick

      - name: Sync batch-1 files
        shell: bash
        run: |
          set -euo pipefail

          target_dir="${GITHUB_WORKSPACE}/upstream/oneclick"
          mkdir -p "${target_dir}"

          rsync -a --delete "/tmp/hz-oneclick/lib/" "${target_dir}/lib/"
          rsync -a --delete "/tmp/hz-oneclick/modules/web/" "${target_dir}/modules/web/"
          rsync -a --delete "/tmp/hz-oneclick/modules/diagnostics/" "${target_dir}/modules/diagnostics/"
          rsync -a --delete "/tmp/hz-oneclick/tests/" "${target_dir}/tests/"

          mkdir -p "${target_dir}/modules" "${target_dir}/tools"
          cp "/tmp/hz-oneclick/hz.sh" "${target_dir}/hz.sh"
          cp "/tmp/hz-oneclick/tools/wp-baseline-verify.sh" "${target_dir}/tools/wp-baseline-verify.sh"

          git -C /tmp/hz-oneclick rev-parse HEAD > "${target_dir}/UPSTREAM_COMMIT.txt"

      - name: Create pull request
        uses: peter-evans/create-pull-request@v6
        with:
          branch: import/batch-1
          base: main
          title: "Import batch-1 from hz-oneclick"
          commit-message: "Import batch-1 from hz-oneclick"
          body: |
            ## Summary
            - Import batch-1 files from hz-oneclick into upstream/oneclick.
            - Record upstream commit SHA.
          labels: import
