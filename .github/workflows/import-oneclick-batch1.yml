name: Import batch-1 from hz-oneclick

on:
  workflow_dispatch:

permissions:
  contents: write
  pull-requests: write

jobs:
  import:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout horizon-lab
        uses: actions/checkout@v4

      - name: Checkout hz-oneclick
        uses: actions/checkout@v4
        with:
          repository: Hello-Pork-Belly/hz-oneclick
          path: upstream/_src/hz-oneclick
          # For private/internal hz-oneclick, set repo secret HZ_ONECLICK_TOKEN (classic PAT w/ read access).
          # For public repos, github.token fallback is sufficient.
          token: ${{ secrets.HZ_ONECLICK_TOKEN || github.token }}

      - name: Sync batch-1 files
        shell: bash
        run: |
          set -euo pipefail

          target_dir="${GITHUB_WORKSPACE}/archive/upstream-20260215/oneclick"
          src_dir="${GITHUB_WORKSPACE}/upstream/_src/hz-oneclick"

          mkdir -p \
            "${target_dir}" \
            "${target_dir}/lib" \
            "${target_dir}/modules/web" \
            "${target_dir}/modules/diagnostics" \
            "${target_dir}/tests" \
            "${target_dir}/tools"

          rsync -a --delete "${src_dir}/lib/" "${target_dir}/lib/"
          rsync -a --delete "${src_dir}/modules/web/" "${target_dir}/modules/web/"
          rsync -a --delete "${src_dir}/modules/diagnostics/" "${target_dir}/modules/diagnostics/"
          rsync -a --delete "${src_dir}/tests/" "${target_dir}/tests/"

          cp "${src_dir}/hz.sh" "${target_dir}/hz.sh"
          cp "${src_dir}/tools/wp-baseline-verify.sh" "${target_dir}/tools/wp-baseline-verify.sh"

          git -C "${src_dir}" rev-parse HEAD > "${target_dir}/UPSTREAM_COMMIT.txt"

      - name: Create pull request
        uses: peter-evans/create-pull-request@v6
        with:
          branch: import/batch-1
          base: main
          title: "Import batch-1 from hz-oneclick"
          commit-message: "Import batch-1 from hz-oneclick"
          body: |
            ## Summary
            - Import batch-1 files from hz-oneclick into archive/upstream-20260215/oneclick.
            - Record upstream commit SHA.
          labels: import
